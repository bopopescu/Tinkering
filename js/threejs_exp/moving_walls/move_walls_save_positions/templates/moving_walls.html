<!DOCTYPE html>
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">

<meta http-equiv='cache-control' content='no-cache'>
<meta http-equiv='expires' content='0'>
<meta http-equiv='pragma' content='no-cache'>

		<title>Moving the walls</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>

			body {
				font-family: Monospace;
				background-color: #f0f0f0;
				margin: 0px;
				overflow: hidden;

				}

		.panel {
			font-family: 'Playfair Display';
			font-size: 0.85em;
			letter-spacing: 0.2em;
			position: absolute;
			top: 10px;
			left:10px;
			margin-left:5px;
			padding-left: 10px;
			padding-top: 20px;
			width: 200px;
			height: 200px;
			background-color:grey;
			z-index: 9999;
			opacity: 0.8;
		}

		.titlepanel {
			font-family: 'Playfair Display';
			font-size: 1.5em;
			letter-spacing: 0.1em;
			text-align: center;

		}


		</style>
	</head>
	<body>
    <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.5/socket.io.min.js"></script>
		<script src="/static/js/simple_flat/three.js"></script>
		<script src="/static/js/simple_flat/TrackballControls.js"></script>
		<script src="/static/js/simple_flat/stats.js"></script>
		<script src="/static/js/object_museum.js"></script>
		<script src="/static/js/make_objects.js"></script>
		<script src="/static/js/drag_flat.js"></script>
		<!-- jquery -->
		<script src="/static/js/js/jquery.min.js"></script>
		<!-- jquery-ui -->
		<script src="/static/js/jquery-ui.js"></script>


		<script>

			var container, stats;
			var camera, controls, scene, projector, renderer;
			var objects = [], plane;

			var mouse = new THREE.Vector2(),
			offset = new THREE.Vector3(),
			INTERSECTED, SELECTED;
			namespace = '/pos'; // change to an empty string to use the global namespace
      var socket = io.connect('http://' + document.domain + ':' + location.port + namespace);

			init();
			animate();

			function init() {

				container = document.createElement( 'div' );
				document.body.appendChild( container );

				camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 1, 10000 );
				camera.position.z = 1000;
				camera.position.y = -1000;
				camera.position.x = 0;

				controls = new THREE.TrackballControls( camera );
				controls.rotateSpeed = 1.0;
				controls.zoomSpeed = 1.2;
				controls.panSpeed = 0.8;
				controls.noZoom = false;
				controls.noPan = false;
				controls.staticMoving = true;
				controls.dynamicDampingFactor = 0.3;

				scene = new THREE.Scene();

				scene.add( new THREE.AmbientLight( 0x505050 ) );

				var light = new THREE.SpotLight( 0xffffff, 1.5 );
				light.position.set( 200, 500, 2000 );
				light.castShadow = true;

				light.shadowCameraNear = 200;
				light.shadowCameraFar = camera.far;
				light.shadowCameraFov = 50;

				light.shadowBias = -0.00022;
				light.shadowDarkness = 0.5;

				light.shadowMapWidth = 2048;
				light.shadowMapHeight = 2048;

				scene.add( light );

				//make_objects_onflat()
				make_uniform_ground()  // make the board
				//make_small_seats()     // make the seats
				//make_seat()            // make the seat
				listwalls = {}
				socket.emit( 'begin',  "hello from client"); // send mess to server for ping pong..
				socket.on('server_pos', function(msg) {

							// alert('Hello from socket.on !!! ')
							// alert(Object.keys(msg))

							for (i=0; i < Object.keys(msg).length; i++){ // Create the objects at the beginning
									var k = Object.keys(msg)[i]
									//alert(k)
									make_wall(k, msg[k])
							}

					  });// end socket.on

				init_drag()
				// console.log('All initialized !!!! ');
				//alert('All initialized !!!! ');

				renderer = new THREE.WebGLRenderer( { antialias: true } );
				renderer.sortObjects = false;
				renderer.setSize( window.innerWidth, window.innerHeight );
				renderer.shadowMapEnabled = true;
				renderer.shadowMapType = THREE.PCFShadowMap;
				renderer.domElement.addEventListener( 'mousemove', onDocumentMouseMove, false );
				renderer.domElement.addEventListener( 'mousedown', onDocumentMouseDown, false );
				renderer.domElement.addEventListener( 'mouseup', onDocumentMouseUp, false );

				//-------------------------- Infos

				function give_infos(){

	// 				mousePos = {
	// 		x: event.pageX,
	// 		y: event.pageY
	// };


							if ( INTERSECTED ){
										// $('.panel').css('color',"green")

										var x = document.getElementsByClassName("panel");
										var i;
										for (i = 0; i < x.length; i++) {
											x[i].style.backgroundColor = "grey";
											//x[i].style.left = "300px";
											x[i].style.left = event.pageX + "px";
											x[i].style.top = event.pageY + "px";
										}

							}
							else{

								var x = document.getElementsByClassName("panel");
								var i;
								for (i = 0; i < x.length; i++) {
									x[i].style.backgroundColor = "grey";
									x[i].style.left = "10px";
									x[i].style.top = "10px";
								}
							}
						}
				renderer.domElement.addEventListener( 'mouseup', give_infos, false );

				//------------------------- Emit the positions of all the objects..

				function emitpos(){      // emits the positions toward the server to save them
					var listpos = {}       // list of all the positions
					for (i in objects){
						listpos[objects[i].name] = objects[i].position;   // add position to listpos
						}
					socket.emit( 'message', JSON.stringify(listpos));
					//console.log("yeppppppppppppppppppp !!!!")
				}
				renderer.domElement.addEventListener( 'mouseup', emitpos, false );

				//---------------------------

				container.appendChild( renderer.domElement );
				window.addEventListener( 'resize', onWindowResize, false );

			}

			function animate() {
				requestAnimationFrame( animate );
				render();
			}

			function render() {
				controls.update();
				renderer.render( scene, camera );
			}

		</script>


		<div style="cursor: auto;">
			<!-- <canvas style="width: 1007px; height: 804px;" height="804" width="1007"></canvas> -->
			<div style="position: absolute; top: 10px; width: 100%; height: 30%; text-align: center;">
		 				move shapes
			</div>

			<div class="panel">

						<div class="titlepanel" >
									Parameters
						</div>

						<br><br>

						<!-- <div>
								  <input type="checkbox" id="rotate" name="rot">
								  <label for="rotate">Rotation</label>
						</div> -->

						<!-- <div>
									<input type="checkbox" id="infos" name="inf">
									<label for="informatons">Show Infos</label>
						</div> -->

			</div>

		</div>


		<script>
		//-------------------------- Infos
		function give_infos(){
			//$('.panel').css('color',"green")
			$('.panel').css('opacity',"1")
					// if ( INTERSECTED ){
					// 			$('.panel').css('color',"green")
					// }
				}
		renderer.domElement.addEventListener( 'mouseup', give_infos, false );

		</script>


</body></html>
